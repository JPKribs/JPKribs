name: Update Profile SVG
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  generate-svg:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Fetch Real-Time Stats
        run: |
          # Fetching star counts from GitHub API
          SWIFT_STARS=$(curl -s https://api.github.com/repos/jellyfin/Swiftfin | jq -r '.stargazers_count')
          if [ "$SWIFT_STARS" -gt 1000 ]; then
            SWIFT_STARS_FORMATTED="$(echo "scale=1; $SWIFT_STARS/1000" | bc)k"
          else
            SWIFT_STARS_FORMATTED="$SWIFT_STARS"
          fi
          
          PROXY_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-discovery-proxy | jq -r '.stargazers_count')
          POSTER_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-plugin-episodepostergenerator | jq -r '.stargazers_count')
          UPDATED=$(date +'%b %d, %Y')

          cat <<EOF > profile-summary.svg
          <svg width="800" height="320" viewBox="0 0 800 320" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="800" height="320" rx="12" fill="#0d1117" stroke="#30363d"/>
            
            <text x="400" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#f0f6fc">Joe Kribs</text>
            <text x="400" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#8b949e">Jellyfin Team Member ‚Ä¢ Swiftfin Co-Maintainer</text>

            <rect x="50" y="130" width="220" height="115" rx="8" fill="#161b22" stroke="#F05138" stroke-width="1.5"/>
            <g transform="translate(148, 142) scale(0.8)">
              <path d="M11.583 0C11.385 0 11.201.103 11.08.272c-.116.162-.124.372-.02.544 1.343 2.215 4.381 6.892 4.381 10.375 0 2.275-1.391 3.864-3.414 3.864-2.583 0-4.665-2.617-4.665-5.32 0-3.35 1.543-5.352 2.651-6.702.164-.202.174-.486.026-.697-.148-.21-.424-.282-.663-.176-3.837 1.706-9.155 5.86-9.155 11.668 0 5.673 4.636 9.619 10.232 9.619 8.528 0 13.682-6.52 13.682-12.871C24.135 4.544 17.653.111 11.758.006c-.058-.004-.117-.006-.175-.006z" fill="#F05138"/>
            </g>
            <text x="160" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Swiftfin</text>
            <text x="160" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $SWIFT_STARS_FORMATTED Stars</text>

            <rect x="290" y="130" width="220" height="115" rx="8" fill="#161b22" stroke="#00ADD8" stroke-width="1.5"/>
            <g transform="translate(388, 142) scale(0.8)">
              <path d="M1.81 7.182c.96-1.411 2.373-2.484 4.091-3.136C7.618 3.394 9.47 3.064 11.455 3.064c1.928 0 3.65.305 5.163.915a10.026 10.026 0 013.91 2.652l2.67-2.607a13.398 13.398 0 00-5.364-3.523C15.895.166 13.784 0 11.5 0 9.076 0 6.843.433 4.8 1.298 2.757 2.163 1.085 3.442-.216 5.136L1.81 7.182zm19.645 2.112v7.19h-10.01v3.218h13.344v-10.41h-3.334zM11.455 20.936c-2.344 0-4.242-.692-5.694-2.076-1.452-1.384-2.178-3.351-2.178-5.9s.726-4.516 2.178-5.9c1.452-1.384 3.35-2.076 5.694-2.076 1.489 0 2.809.284 3.961.85a7.1 7.1 0 012.83 2.4l2.67-2.607c-.985-1.31-2.273-2.336-3.864-3.078C15.461.916 13.582.545 11.455.545 8.125.545 5.378 1.63 3.213 3.8 1.048 5.97 0 8.956 0 12.76c0 3.804 1.048 6.79 3.213 8.96 2.165 2.17 4.912 3.255 8.242 3.255 2.454 0 4.673-.553 6.655-1.658 1.981-1.106 3.486-2.738 4.514-4.896l-2.67-2.607c-.672 1.347-1.642 2.396-2.91 3.148-1.268.752-2.798 1.128-4.589 1.128v-.154z" fill="#00ADD8"/>
            </g>
            <text x="400" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Discovery Proxy</text>
            <text x="400" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $PROXY_STARS Stars</text>

            <rect x="530" y="130" width="220" height="115" rx="8" fill="#161b22" stroke="#512BD4" stroke-width="1.5"/>
            <g transform="translate(628, 142) scale(0.8)">
              <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 21.6c-5.302 0-9.6-4.298-9.6-9.6S6.698 2.4 12 2.4s9.6 4.298 9.6 9.6-4.298 9.6-9.6 9.6zm-1.8-13.8v8.4l5.4-4.2-5.4-4.2z" fill="#512BD4"/>
            </g>
            <text x="640" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Poster Generator</text>
            <text x="640" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $POSTER_STARS Stars</text>

            <line x1="50" y1="275" x2="750" y2="275" stroke="#30363d" />
            <text x="50" y="300" font-family="Arial, sans-serif" font-size="12" fill="#8b949e">üåê joseph.kribs.net  ‚Ä¢  ‚úâÔ∏è joseph@kribs.net</text>
            <text x="750" y="300" text-anchor="end" font-family="Arial, sans-serif" font-size="12" fill="#8b949e">üìç Littleton, CO ‚Ä¢ $UPDATED</text>
          </svg>
          EOF

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add profile-summary.svg
          git commit -m "chore: refresh profile summary with official logos" || exit 0
          git push
