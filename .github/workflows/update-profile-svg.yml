name: Update Profile SVG
on:
  schedule:
    - cron: '0 0 * * *'

jobs:
  generate-svg:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Fetch Stats and Generate SVG
        run: |
          # Fetch Star counts via GitHub API
          SWIFTFIN_STARS=$(curl -s https://api.github.com/repos/JPKribs/Swiftfin | jq '.stargazers_count')
          PROXY_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-discovery-proxy | jq '.stargazers_count')
          POSTER_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-plugin-episodepostergenerator | jq '.stargazers_count')
          UPDATED=$(date +'%b %Y')

          # Generate the SVG file
          cat <<EOF > profile-summary.svg
          <svg fill="none" viewBox="0 0 800 360" width="800" height="360" xmlns="http://www.w3.org/2000/svg">
            <foreignObject width="100%" height="100%">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <style>
                  .container {
                    font-family: -apple-system, system-ui, sans-serif;
                    background: #0d1117;
                    border: 1px solid #30363d;
                    border-radius: 12px;
                    padding: 35px;
                    color: #c9d1d9;
                  }
                  .header { text-align: center; margin-bottom: 30px; }
                  .name { font-size: 32px; font-weight: 700; color: #f0f6fc; margin: 0; }
                  .role { font-size: 16px; color: #8b949e; margin-top: 8px; }
                  
                  .grid {
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 20px;
                    margin-bottom: 30px;
                  }
                  .card {
                    background: #161b22;
                    border: 1px solid #30363d;
                    border-radius: 10px;
                    padding: 20px;
                    text-align: center;
                    transition: border-color 0.3s;
                  }
                  .icon { height: 35px; margin-bottom: 12px; }
                  .card-title { font-size: 14px; font-weight: 600; color: #f0f6fc; display: block; margin-bottom: 4px; }
                  .card-stat { font-size: 12px; color: #8b949e; }
                  
                  .footer {
                    display: flex;
                    justify-content: space-between;
                    border-top: 1px solid #30363d;
                    padding-top: 20px;
                    font-size: 12px;
                    color: #8b949e;
                  }
                  .contact { display: flex; gap: 20px; }
                  .contact span { display: flex; align-items: center; gap: 6px; }
                </style>
                <div class="container">
                  <div class="header">
                    <h1 class="name">Joe Kribs</h1>
                    <div class="role">Jellyfin Team Member ‚Ä¢ Swiftfin Co-Maintainer</div>
                  </div>
                  
                  <div class="grid">
                    <div class="card">
                      <img class="icon" src="https://raw.githubusercontent.com/simple-icons/simple-icons/develop/icons/swift.svg" style="filter: invert(51%) sepia(43%) saturate(4155%) hue-rotate(346deg) brightness(97%) contrast(100%);" />
                      <span class="card-title">Swiftfin</span>
                      <span class="card-stat">‚≠ê $SWIFTFIN_STARS Stars</span>
                    </div>
                    <div class="card">
                      <img class="icon" src="https://raw.githubusercontent.com/simple-icons/simple-icons/develop/icons/go.svg" style="filter: invert(72%) sepia(20%) saturate(2834%) hue-rotate(143deg) brightness(95%) contrast(101%);" />
                      <span class="card-title">Discovery Proxy</span>
                      <span class="card-stat">‚≠ê $PROXY_STARS Stars</span>
                    </div>
                    <div class="card">
                      <img class="icon" src="https://raw.githubusercontent.com/simple-icons/simple-icons/develop/icons/dotnet.svg" style="filter: invert(34%) sepia(74%) saturate(1478%) hue-rotate(252deg) brightness(91%) contrast(97%);" />
                      <span class="card-title">Poster Generator</span>
                      <span class="card-stat">‚≠ê $POSTER_STARS Stars</span>
                    </div>
                  </div>

                  <div class="footer">
                    <div class="contact">
                      <span>üåê joseph.kribs.net</span>
                      <span>‚úâÔ∏è joseph@kribs.net</span>
                    </div>
                    <div>üìç Littleton, CO ‚Ä¢ Updated $UPDATED</div>
                  </div>
                </div>
              </div>
            </foreignObject>
          </svg>
          EOF

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add profile-summary.svg
          git commit -m "chore: update profile statistics" || exit 0
          git push
