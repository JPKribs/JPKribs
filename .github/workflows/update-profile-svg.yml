name: Update Profile SVG
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  generate-svg:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Fetch Real-Time Stats
        run: |
          SWIFT_STARS=$(curl -s https://api.github.com/repos/jellyfin/Swiftfin | jq -r '.stargazers_count')
          if [ "$SWIFT_STARS" -gt 1000 ]; then
            SWIFT_STARS_FORMATTED="$(echo "scale=1; $SWIFT_STARS/1000" | bc)k"
          else
            SWIFT_STARS_FORMATTED="$SWIFT_STARS"
          fi
          
          PROXY_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-discovery-proxy | jq -r '.stargazers_count')
          POSTER_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-plugin-episodepostergenerator | jq -r '.stargazers_count')
          UPDATED=$(date +'%b %d, %Y')

          cat <<EOF > profile-summary.svg
          <svg width="800" height="320" viewBox="0 0 800 320" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="800" height="320" rx="12" fill="#0d1117" stroke="#30363d"/>
            
            <text x="400" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#f0f6fc">Joe Kribs</text>
            <text x="400" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#8b949e">Jellyfin Team Member ‚Ä¢ Swiftfin Co-Maintainer</text>

            <rect x="50" y="130" width="220" height="120" rx="8" fill="#161b22" stroke="#30363d"/>
            <image x="143" y="145" width="34" height="34" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVR4nO2av0vDQByFv6S1SAtuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp/zMAn9ID+O7+o0mS8S8A1I/u7v+W9AB9O2/A5fT6vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZT+S4C+W873p/QA6/MGfV7vS6QHWJ836PN6X9K/AQIARL928G7mAAAAAElFTkSuQmCC"/>
            <text x="160" y="198" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Swiftfin</text>
            <text x="160" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#F05138">Swift</text>
            <text x="160" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $SWIFT_STARS_FORMATTED Stars</text>

            <rect x="290" y="130" width="220" height="120" rx="8" fill="#161b22" stroke="#30363d"/>
            <image x="383" y="145" width="34" height="34" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAACv0lEQVR4nO2av0vDQBjHv6S1SAtuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp/zMAn9ID+O7+o0mS8S8A1I/u7v+W9AB9O2/A5fT6vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZT+S4C+W873p/QA6/MGfV7vS6QHWJ836PN6X9K/AQIARL928G7mAAAAAElFTkSuQmCC"/>
            <text x="400" y="198" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Discovery Proxy</text>
            <text x="400" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#00ADD8">Go</text>
            <text x="400" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $PROXY_STARS Stars</text>

            <rect x="530" y="130" width="220" height="120" rx="8" fill="#161b22" stroke="#30363d"/>
            <image x="623" y="145" width="34" height="34" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAACiklEQVR4nO2av0vDQBjHv6S1SAtuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp6CQuLbgp/zMAn9ID+O7+o0mS8S8A1I/u7v+W9AB9O2/A5fT6vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZQeYH3eoM/rfTalB1ifN+jzep9N6QHW5w36vN5nU3qA9XmDPq/32ZT+S4C+W873p/QA6/MGfV7vS6QHWJ836PN6X9K/AQIARL928G7mAAAAAElFTkSuQmCC"/>
            <text x="640" y="198" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Poster Generator</text>
            <text x="640" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#512BD4">.NET</text>
            <text x="640" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $POSTER_STARS Stars</text>

            <line x1="50" y1="280" x2="750" y2="280" stroke="#30363d" />
            <text x="50" y="305" font-family="Arial, sans-serif" font-size="12" fill="#8b949e">üåê joseph.kribs.net  ‚Ä¢  ‚úâÔ∏è joseph@kribs.net</text>
            <text x="750" y="305" text-anchor="end" font-family="Arial, sans-serif" font-size="12" fill="#8b949e">üìç Littleton, CO ‚Ä¢ $UPDATED</text>
          </svg>
          EOF

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add profile-summary.svg
          git commit -m "chore: use rasterized high-quality logos" || exit 0
          git push
