name: Update Profile SVG
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  generate-svg:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Fetch Real-Time Stats
        run: |
          # Fetch star counts
          SWIFT_STARS=$(curl -s https://api.github.com/repos/jellyfin/Swiftfin | jq -r '.stargazers_count')
          if [ "$SWIFT_STARS" -gt 1000 ]; then
            SWIFT_STARS_FORMATTED="$(echo "scale=1; $SWIFT_STARS/1000" | bc)k"
          else
            SWIFT_STARS_FORMATTED="$SWIFT_STARS"
          fi
          
          PROXY_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-discovery-proxy | jq -r '.stargazers_count')
          POSTER_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-plugin-episodepostergenerator | jq -r '.stargazers_count')
          UPDATED=$(date +'%b %d, %Y')

          cat <<EOF > profile-summary.svg
          <svg width="800" height="320" viewBox="0 0 800 320" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="800" height="320" rx="12" fill="#0d1117" stroke="#30363d"/>
            
            <text x="400" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#f0f6fc">Joe Kribs</text>
            <text x="400" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#8b949e">Jellyfin Team Member ‚Ä¢ Swiftfin Co-Maintainer</text>

            <rect x="50" y="130" width="220" height="110" rx="8" fill="#161b22" stroke="#30363d" stroke-width="1"/>
            <image x="148" y="145" width="24" height="24" href="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+U3dpZnQ8L3RpdGxlPjxwYXRoIGQ9Ik0xMS41ODMgMEMxMS4zODUgMCAxMS4yMDEuMTAzIDExLjA4LjI3MmMtLjExNi4xNjItLjEyNC4zNzItLjAyLjU0NCAxLjM0MyAyLjIxNSA0LjM4MSA2Ljg5MiA0LjM4MSAxMC4zNzUgMCAyLjI3NS0xLjM5MSAzLjg2NC0zLjQxNCAzLjg2NC0yLjU4MyAwLTQuNjY1LTIuNjE3LTQuNjY1LTUuMzIgMC0zLjM1IDEuNTQzLTUuMzUyIDIuNjUxLTYuNzAyLjE2NC0uMjAyLjE3NC0uNDg2LjAyNi0uNjk3LS4xNDgtLjIxLS40MjQtLjI4Mi0uNjYzLS4xNzYtMy44MzcgMS43MDYtOS4xNTUgNS44Ni05LjE1NSAxMS42NjggMCA1LjY3MyA0LjYzNiA5LjYxOSAxMC4yMzIgOS42MTkgOC41MjggMCAxMy42ODItNi41MiAxMy42ODItMTIuODcxQzI0LjEzNSA0LjU0NCAxNy42NTMuMTExIDExLjc1OC4wMDZjLS4wNTgtLjAwNC0uMTE3LS4wMDYtLjE3NS0uMDA2eiIgZmlsbD0iI0YwNTEzOCIvPjwvc3ZnPg=="/>
            <text x="160" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Swiftfin</text>
            <text x="160" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#F05138">Swift</text>
            <text x="160" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $SWIFT_STARS_FORMATTED Stars</text>

            <rect x="290" y="130" width="220" height="110" rx="8" fill="#161b22" stroke="#30363d" stroke-width="1"/>
            <image x="388" y="145" width="24" height="24" href="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+R288L3RpdGxlPjxwYXRoIGQ9Ik0xLjgxIDcuMTgyYy45Ni0xLjQxMSAyLjM3My0yLjQ4NCA0LjA5MS0zLjEzNkM3LjYxOCAzLjM5NCA5LjQ3IDMuMDY0IDExLjQ1NSAzLjA2NGMxLjkyOCAwIDMuNjUuMzA1IDUuMTYzLjkxNWExMC4wMjYgMTAuMDI2IDAgMDEzLjkxIDIuNjUybDIuNjctMi42MDdhMTMuMzk4IDEzLjM5OCAwIDAwLTUuMzY0LTMuNTIzQzE1Ljg5NS4xNjYgMTMuNzg0IDAgMTEuNSAwIDkuMDc2IDAgNi44NDMuNDMzIDQuOCAxLjI5OCAyLjc1NyAyLjE2MyAxLjA4NSAzLjQ0Mi0uMjE2IDUuMTM2TDEuODEgNy4xODJ6bTE5LjY0NSAyLjExMnY3LjE5aC0xMC4wMXYzLjIxOGgxMy4zNDR2LTEwLjQxaC0zLjMzNHpNMTEuNDU1IDIwLjkzNmMtMi4zNDQgMC00LjI0Mi0uNjkyLTUuNjk0LTIuMDc2LTEuNDUyLTEuMzg0LTIuMTc4LTMuMzUxLTIuMTc4LTUuOXMuNzI2LTQuNTE2IDIuMTc4LTUuOWMxLjQ1Mi0xLjM4NCAzLjM1LTIuMDc2IDUuNjk0LTIuMDc2IDEuNDg5IDAgMi44MDkuMjg0IDMuOTYxLjg1YTcuMSA3LjEgMCAwMTIuODMgMi40bDIuNjctMi42MDdjLS45ODUtMS4zMS0yLjI3My0yLjMzNi0zLjg2NC0zLjA3OEMxNS40NjEuOTE2IDEzLjU4Mi41NDUgMTEuNDU1LjU0NSA4LjEyNS41NDUgNS4zNzggMS42MyAzLjIxMyAzLjggMS4wNDggNS45NyAwIDguOTU2IDAgMTIuNzZjMCAzLjgwNCAxLjA0OCA2Ljc5IDMuMjEzIDguOTYgMi4xNjUgMi4xNyA0LjkxMiAzLjI1NSA4LjI0MiAzLjI1NSAyLjQ1NCAwIDQuNjczLS41NTMgNi42NTUtMS42NTggMS45ODEtMS4xMDYgMy40ODYtMi43MzggNC41MTQtNC44OTZsLTIuNjctMi42MDdjLS42NzIgMS4zNDctMS42NDIgMi4zOTYtMi45MSAzLjE0OC0xLjI2OC43NTItMi43OTggMS4xMjgtNC41ODkgMS4xMjh2LS4xNTR6IiBmaWxsPSIjMDBBREQ4Ii8+PC9zdmc+"/>
            <text x="400" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Discovery Proxy</text>
            <text x="400" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#00ADD8">Go</text>
            <text x="400" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $PROXY_STARS Stars</text>

            <rect x="530" y="130" width="220" height="110" rx="8" fill="#161b22" stroke="#30363d" stroke-width="1"/>
            <image x="628" y="145" width="24" height="24" href="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+Lm5ldDwvdGl0bGU+PHBhdGggZD0iTTEyIDBDNS4zNzMgMCAwIDUuMzczIDAgMTJzNS4zNzMgMTIgMTIgMTIgMTItNS4zNzMgMTItMTJTMTguNjI3IDAgMTIgMHptMCAyMS42Yy01LjMwMiAwLTkuNi00LjI5OC05LjYtOS42UzYuNjk4IDIuNCAxMiAyLjRzOS42IDQuMjk4IDkuNiA5LjYtNC4yOTggOS42LTkuNiA5LjZ6bS0xLjgtMTMuOHY4LjRsNS40LTQuMi01LjQtNC4yeiIgZmlsbD0iIzUxMkRENCIvPjwvc3ZnPg=="/>
            <text x="640" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f0f6fc">Poster Generator</text>
            <text x="640" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#512BD4">.NET</text>
            <text x="640" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#8b949e">‚≠ê $POSTER_STARS Stars</text>

            <line x1="50" y1="275" x2="750" y2="275" stroke="#30363d" />
            <text x="50" y="300" font-family="Arial, sans-serif" font-size="12" fill="#8b949e">üåê joseph.kribs.net  ‚Ä¢  ‚úâÔ∏è joseph@kribs.net</text>
            <text x="750" y="300" text-anchor="end" font-family="Arial, sans-serif" font-size="12" fill="#8b949e">üìç Littleton, CO ‚Ä¢ $UPDATED</text>
          </svg>
          EOF

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add profile-summary.svg
          git commit -m "chore: refresh profile statistics" || exit 0
          git push
