name: Update Profile SVG
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  generate-svg:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Fetch Stats and Generate SVG
        run: |
          SWIFTFIN_STARS=$(curl -s https://api.github.com/repos/JPKribs/Swiftfin | jq '.stargazers_count')
          PROXY_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-discovery-proxy | jq '.stargazers_count')
          POSTER_STARS=$(curl -s https://api.github.com/repos/JPKribs/jellyfin-plugin-episodepostergenerator | jq '.stargazers_count')
          UPDATED=$(date +'%b %Y')

          cat <<EOF > profile-summary.svg
          <svg width="800" height="320" viewBox="0 0 800 320" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="800" height="320" rx="12" fill="#0d1117" stroke="#30363d" stroke-width="1"/>
            
            <text x="400" y="60" text-anchor="middle" font-family="Segoe UI, Helvetica, Arial, sans-serif" font-size="32" font-weight="bold" fill="#f0f6fc">Joe Kribs</text>
            <text x="400" y="90" text-anchor="middle" font-family="Segoe UI, Helvetica, Arial, sans-serif" font-size="16" fill="#8b949e">Jellyfin Team Member ‚Ä¢ Swiftfin Co-Maintainer</text>

            <rect x="50" y="130" width="220" height="100" rx="8" fill="#161b22" stroke="#30363d"/>
            <rect x="290" y="130" width="220" height="100" rx="8" fill="#161b22" stroke="#30363d"/>
            <rect x="530" y="130" width="220" height="100" rx="8" fill="#161b22" stroke="#30363d"/>

            <path d="M68.5 155c1.2-1.2 5.5-5.3 12.3-5.3 8.5 0 13.7 6.5 13.7 12.8 0 8.5-7 14.5-15.5 14.5-6.5 0-11-4-12.2-5.5" stroke="#F05138" stroke-width="2.5"/> <text x="160" y="175" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="600" fill="#f0f6fc">Swiftfin</text>
            <text x="160" y="200" text-anchor="middle" font-family="sans-serif" font-size="14" fill="#8b949e">‚≠ê $SWIFTFIN_STARS Stars</text>

            <text x="400" y="175" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="600" fill="#f0f6fc">Discovery Proxy</text>
            <text x="400" y="200" text-anchor="middle" font-family="sans-serif" font-size="14" fill="#8b949e">‚≠ê $PROXY_STARS Stars</text>

            <text x="640" y="175" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="600" fill="#f0f6fc">Poster Generator</text>
            <text x="640" y="200" text-anchor="middle" font-family="sans-serif" font-size="14" fill="#8b949e">‚≠ê $POSTER_STARS Stars</text>

            <line x1="50" y1="260" x2="750" y2="260" stroke="#30363d" />
            <text x="50" y="290" font-family="sans-serif" font-size="12" fill="#8b949e">üåê joseph.kribs.net  ‚Ä¢  ‚úâÔ∏è joseph@kribs.net</text>
            <text x="750" y="290" text-anchor="end" font-family="sans-serif" font-size="12" fill="#8b949e">üìç Littleton, CO ‚Ä¢ $UPDATED</text>
          </svg>
          EOF

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add profile-summary.svg
          git commit -m "chore: update profile statistics" || exit 0
          git pus
